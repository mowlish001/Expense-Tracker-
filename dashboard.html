<!DOCTYPE html>
<html>
<head>
    <title>Smart Expense Tracker – {{ page_title }}</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background-color: #f9f9f9; }

        /* Topbar */
        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
        }
        .topbar h1 { margin: 0; font-size: 24px; }
        .topbar .user-section { display: flex; align-items: center; gap: 10px; }
        .topbar a.button {
            color: white; 
            text-decoration: none; 
            padding: 5px 10px; 
            background-color: #2980b9; 
            border-radius: 5px;
        }
        .topbar a.button:hover { background-color: #3498db; }

        /* Table styling */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background-color: white; }
        th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
        th { background-color: #2c3e50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        /* Filter form */
        .filter-form { display: flex; gap: 10px; align-items: center; margin: 15px 0; }
        .filter-form select, .filter-form input[type="date"], .filter-form button { 
            padding:5px 10px; border-radius:5px; border:1px solid #ccc; 
        }
        .filter-form button { background-color:#2c3e50; color:white; border:none; cursor:pointer; }
        .filter-form button:hover { background-color:#34495e; }

        /* Total Expense */
        h3.total { margin-top: 20px; color: #c0392b; }
    </style>
</head>
<body>
<!-- Top Bar -->
<div class="topbar">
    <div class="top-left">
        <span>Welcome, {{ name }}</span>
    </div>
    <div class="top-center">
        <h1>SMART EXPENSE TRACKER</h1>
    </div>
    <div class="top-right">
        <a href="{{ url_for('user_info') }}" class="button">User Info</a>
        <a href="/logout" class="button">Logout</a>
    </div>
</div>

<!-- Add Expense Floating Button -->
<a href="/add" class="add-expense-btn">+ Add Expense</a>

<form method="get" action="/dashboard" class="filter-form">

    <div class="filter-field">
        <label>Category</label>
        <select name="category" onchange="this.form.submit()">
            <option value="All">All Categories</option>
            {% for c in categories %}
                <option value="{{ c['category'] }}"
                    {% if selected_category == c['category'] %}selected{% endif %}>
                    {{ c['category'] }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-field">
        <label>From</label>
        <input type="date" name="start" value="{{ start }}" onchange="this.form.submit()">
    </div>

    <div class="filter-field">
        <label>To</label>
        <input type="date" name="end" value="{{ end }}" onchange="this.form.submit()">
    </div>

    <div class="filter-field clear-field">
        <label>&nbsp;</label>
        <a href="{{ url_for('dashboard') }}" class="clear-btn">Clear</a>
    </div>

</form>


<!-- EXPENSE TABLE -->
<table>
    <tr>
    <th>Expense Name</th>
    <th>Category</th>
    <th>Amount (₹)</th>
    <th>Expense Date</th>
    <th>Actions</th>
</tr>



    {% for e in expenses %}
    <tr>
        <td>{{ e['title'] }}</td>
        <td>{{ e['category'] }}</td>
        <td>₹{{ e['amount'] }}</td>
        <td>{{ e['expense_date'].strftime('%d-%m-%Y') }}</td>
        <td>
            <a href="/edit/{{ e['id'] }}">Edit</a> |
            <a href="/delete/{{ e['id'] }}" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</a>
            
        </td>
    </tr>
    {% endfor %}
</table>

<!-- Budget Card (Centered below table) -->
<div class="budget-card">
    <p class="spent">
        Total Spent: <strong>₹{{ "{:,.0f}".format(total_expense) }}</strong> 
        out of <strong>₹{{ "{:,.0f}".format(user.monthly_income) }}</strong>
    </p>

    {% if not is_exceeded %}
        <p class="left">
            Money Left: <strong>₹{{ "{:,.0f}".format(money_left) }}</strong>
        </p>
    {% else %}
        <p class="exceeded">
            Budget Exceeded by <strong>₹{{ "{:,.0f}".format(money_left) }}</strong>
        </p>
    {% endif %}
</div>


</body>
</html>
